---
# nfs_server_configuration/tasks/main.yml

- name: 'create directories from variable nfs_server_exports'
  file:
    path: "{{ item['path'] }}"
    state: 'directory'
    owner: "{{ item['owner'] | default('root') }}"
    group: "{{ item['group'] | default('root') }}"
    mode: "{{ item['mode'] | default('0755') }}"
  loop: "{{ nfs_server_exports | flatten }}"
  notify:
    - 'restart nfs-server'

- name: 'create /etc/exports from template'
  template:
    src: 'etc_exports.j2'
    dest: "{{ path_to_exports_file }}"
    owner: "{{ exports_file_owner | default('root') }}"
    group: "{{ exports_file_group | default('root') }}"
    mode: "{{ exports_file_mode | default('0644') }}"
  notify:
    - 'restart nfs-server'

- name: 'start and enable the nfs-server service'
  service:
    name: "{{ nfs_server_service }}"
    state: 'started'
    enabled: true
